---
title: "Compare the difference among 3 models when sig in stratified analysis but not intxn analysis"
author: "Lanyu Zhang, Lily Wang"
date: "5/12/2020"
output: html_document
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{R, include = FALSE}
cohort <- "GASPARONI"
data.dir <- file.path("../DATASETS",cohort)
data.dir.neuron <- file.path(data.dir,"step7_neuron_comp/")
```

```{R, include = FALSE, eval = TRUE}
load(paste0(data.dir.neuron, "/GASPARONI.rda"))
```

```{R}
example <- "cg04112626"
```

```{R, message = FALSE, warning = FALSE, include = FALSE}
beta_mat <- betaQN_BMIQ_PCfiltered
pheno_df <- pheno_withNeuronProp_df

beta_female_mat <- betaQN_BMIQ_PCfiltered_female
pheno_female_df <- pheno_female_withNeuronProp_df

beta_male_mat <- betaQN_BMIQ_PCfiltered_male
pheno_male_df <- pheno_male_withNeuronProp_df
  
### Compute M values
mval_mat <- log2(beta_mat / (1 - beta_mat))
mval_female_mat <- log2(beta_female_mat / (1 - beta_female_mat))
mval_male_mat <- log2(beta_male_mat / (1 - beta_male_mat))

pheno_df$Sample <- pheno_df$sample
mval_mat <- mval_mat[row.names(mval_mat) == example, pheno_df$Sample]

pheno_female_df$Sample <- pheno_female_df$sample
mval_female_mat <- mval_female_mat[row.names(mval_female_mat) == example, pheno_female_df$Sample]

pheno_male_df$Sample <- pheno_male_df$sample
mval_male_mat <- mval_male_mat[row.names(mval_male_mat) == example, pheno_male_df$Sample]

predictors_char <- "stage"
covariates_char <- c("age.brain", "sex", "prop.neuron", "slide", "sex*stage", "sex*age.brain")
covariates_char2 <- c("age.brain", "prop.neuron", "slide")

devtools::source_gist("https://gist.github.com/Jennyzly2016/935a94eadb981dc89e441e296ccf7669")

sumOneRegion_df <- data.frame(t(mval_mat))
summary_intxn <- TestSingleRegion_summary(
  predictors_char = predictors_char,
  covariates_char = covariates_char,
  pheno_df = pheno_df,
  sumOneRegion_df = sumOneRegion_df
)

sumOneRegion_female_df <- data.frame(t(mval_female_mat))
summary_female <- TestSingleRegion_summary(
  predictors_char = predictors_char,
  covariates_char = covariates_char2,
  pheno_df = pheno_female_df,
  sumOneRegion_df = sumOneRegion_female_df
)

sumOneRegion_male_df <- data.frame(t(mval_male_mat))
summary_male <- TestSingleRegion_summary(
  predictors_char = predictors_char,
  covariates_char = covariates_char2,
  pheno_df = pheno_male_df,
  sumOneRegion_df = sumOneRegion_male_df
)
```

## interaction analysis result

```{R, echo = FALSE}
print(paste0(example, ":intxn analysis result"))
summary_intxn
```

## sex stratified analysis (female) result

```{R, echo = FALSE}
print(paste0(example, ":sex stratified analysis (female) result"))
summary_female
```

## sex stratified analysis (male) result

```{R, echo = FALSE}
print(paste0(example, ":sex stratified analysis (male) result"))
summary_male
```